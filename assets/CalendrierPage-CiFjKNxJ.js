import{u as ue,c as ie,b as de,h as ce,Q as X}from"./QSpinner-BeAHiIMA.js";import{u as me,b as ve,a as L,Q as fe}from"./QPage-B2hAIiTM.js";import{r as k,a as x,h as Q,g as pe,H as G,I as U,c as ge,s as J,t as _,v as V,u as f,x as s,y as r,D,E as O,F as B,J as be,m as Ve,z as F,A as z,G as $,K as ye,L as he,_ as Y,o as xe,M as H}from"./index-ChM0xqb5.js";import{u as qe,a as ke,Q as S}from"./QInput-C1Bnpugq.js";import{b as Ce,c as Z,d as E,a as T,u as N,e as we,o as Ie}from"./firebase-ll4QkwRt.js";import{Q as W,a as _e,b as Se,C as Ae,c as De,u as Qe}from"./ClosePopup-BhJ-GwiK.js";import{Q as M}from"./QCardSection-96Zbmj6U.js";import{Q as I}from"./QBtn-DQw-i6WG.js";import{Q as Ue}from"./QForm-06Gc_vca.js";import{g as ee}from"./index-35c79a8a-BO3F9RrB.js";import{Q as j}from"./QTooltip-CrfX-LIm.js";import"./focus-manager-BJWzFvJg.js";function $e(u,h){const e=k(null),d=x(()=>u.disable===!0?null:Q("span",{ref:e,class:"no-outline",tabindex:-1}));function p(y){const i=h.value;y?.qAvoidFocus!==!0&&(y?.type.indexOf("key")===0?document.activeElement!==i&&i?.contains(document.activeElement)===!0&&i.focus():e.value!==null&&(y===void 0||i?.contains(y.target)===!0)&&e.value.focus())}return{refocusTargetEl:d,refocusTarget:p}}const Ee={xs:30,sm:35,md:40,lg:50,xl:60},ze={...me,...ue,...qe,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:u=>u==="tf"||u==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},Be=["update:modelValue"];function Re(u,h){const{props:e,slots:d,emit:p,proxy:y}=pe(),{$q:i}=y,C=ve(e,i),g=k(null),{refocusTargetEl:l,refocusTarget:m}=$e(e,g),w=ie(e,Ee),n=x(()=>e.val!==void 0&&Array.isArray(e.modelValue)),c=x(()=>{const a=U(e.val);return n.value===!0?e.modelValue.findIndex(A=>U(A)===a):-1}),v=x(()=>n.value===!0?c.value!==-1:U(e.modelValue)===U(e.trueValue)),o=x(()=>n.value===!0?c.value===-1:U(e.modelValue)===U(e.falseValue)),t=x(()=>v.value===!1&&o.value===!1),b=x(()=>e.disable===!0?-1:e.tabindex||0),q=x(()=>`q-${u} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+(C.value===!0?` q-${u}--dark`:"")+(e.dense===!0?` q-${u}--dense`:"")+(e.leftLabel===!0?" reverse":"")),R=x(()=>{const a=v.value===!0?"truthy":o.value===!0?"falsy":"indet",A=e.color!==void 0&&(e.keepColor===!0||v.value===!0)?` text-${e.color}`:"";return`q-${u}__inner relative-position non-selectable q-${u}__inner--${a}${A}`}),te=x(()=>{const a={type:"checkbox"};return e.name!==void 0&&Object.assign(a,{".checked":v.value,"^checked":v.value===!0?"checked":void 0,name:e.name,value:n.value===!0?e.val:e.trueValue}),a}),le=ke(te),se=x(()=>{const a={tabindex:b.value,role:"switch","aria-label":e.label,"aria-checked":t.value===!0?"mixed":v.value===!0?"true":"false"};return e.disable===!0&&(a["aria-disabled"]="true"),a});function P(a){a!==void 0&&(G(a),m(a)),e.disable!==!0&&p("update:modelValue",ne(),a)}function ne(){if(n.value===!0){if(v.value===!0){const a=e.modelValue.slice();return a.splice(c.value,1),a}return e.modelValue.concat([e.val])}if(v.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(o.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function ae(a){(a.keyCode===13||a.keyCode===32)&&G(a)}function oe(a){(a.keyCode===13||a.keyCode===32)&&P(a)}const re=h(v,t);return Object.assign(y,{toggle:P}),()=>{const a=re();e.disable!==!0&&le(a,"unshift",` q-${u}__native absolute q-ma-none q-pa-none`);const A=[Q("div",{class:R.value,style:w.value,"aria-hidden":"true"},a)];l.value!==null&&A.push(l.value);const K=e.label!==void 0?de(d.default,[e.label]):ce(d.default);return K!==void 0&&A.push(Q("div",{class:`q-${u}__label q-anchor--skip`},K)),Q("div",{ref:g,class:q.value,...se.value,onClick:P,onKeydown:ae,onKeyup:oe},A)}}const Te=ge({name:"QToggle",props:{...ze,icon:String,iconColor:String},emits:Be,setup(u){function h(e,d){const p=x(()=>(e.value===!0?u.checkedIcon:d.value===!0?u.indeterminateIcon:u.uncheckedIcon)||u.icon),y=x(()=>e.value===!0?u.iconColor:null);return()=>[Q("div",{class:"q-toggle__track"}),Q("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},p.value!==void 0?[Q(X,{name:p.value,color:y.value})]:void 0)]}return Re("toggle",h)}}),Fe=J({__name:"CreateEventForm",setup(u){const h=k(""),e=k(""),d=k(""),p=k(""),y=k(""),i=k([""]);function C(){i.value.push("")}function g(w){i.value.splice(w,1)}function l(w){const n=w.target.files?.[0];if(n){const c=new FileReader;c.onload=v=>{y.value=v.target?.result},c.readAsDataURL(n)}}async function m(){const n=ee().currentUser;n&&(await Ce(Z(E,"events"),{title:h.value,address:e.value,description:d.value,date:p.value,image:y.value,songs:i.value.map(c=>({title:c,votes:0})),createdBy:n.uid,createdAt:new Date}),h.value="",e.value="",d.value="",p.value="",y.value="",i.value=[""])}return(w,n)=>(V(),_(L,{class:"q-pa-md q-mb-xl text-black",flat:"",bordered:"",style:{"border-radius":"12px"}},{default:f(()=>[s(M,null,{default:f(()=>n[4]||(n[4]=[r("div",{class:"text-h6"},"CrÃ©er une nouvelle reprÃ©sentation",-1)])),_:1}),s(Ue,{onSubmit:be(m,["prevent"]),class:"q-gutter-md q-pa-sm"},{default:f(()=>[s(S,{modelValue:h.value,"onUpdate:modelValue":n[0]||(n[0]=c=>h.value=c),label:"Titre",outlined:"",dense:"",required:""},null,8,["modelValue"]),s(S,{modelValue:e.value,"onUpdate:modelValue":n[1]||(n[1]=c=>e.value=c),label:"Adresse",outlined:"",dense:"",required:""},null,8,["modelValue"]),s(S,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=c=>d.value=c),label:"Description",type:"textarea",outlined:"",dense:"",required:""},null,8,["modelValue"]),s(S,{modelValue:p.value,"onUpdate:modelValue":n[3]||(n[3]=c=>p.value=c),label:"Date",outlined:"",dense:"",type:"date",required:""},null,8,["modelValue"]),r("div",null,[n[5]||(n[5]=r("div",{class:"text-subtitle2 q-mb-xs"},"Image de l'affiche :",-1)),r("input",{type:"file",accept:"image/*",onChange:l},null,32)]),r("div",null,[n[6]||(n[6]=r("div",{class:"text-subtitle2 q-mb-sm"},"Chansons proposÃ©es :",-1)),(V(!0),D(B,null,O(i.value,(c,v)=>(V(),D("div",{key:v,class:"row items-center q-gutter-sm q-mb-sm"},[s(S,{modelValue:i.value[v],"onUpdate:modelValue":o=>i.value[v]=o,label:"Chanson",dense:"",outlined:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),s(I,{icon:"close",flat:"",dense:"",color:"negative",onClick:o=>g(v)},null,8,["onClick"])]))),128)),s(I,{flat:"",dense:"",icon:"add",label:"Ajouter une chanson",onClick:C})]),s(I,{type:"submit",label:"CrÃ©er",color:"primary",class:"q-mt-md"})]),_:1})]),_:1}))}}),Oe={class:"row items-start no-wrap q-col-gutter-md"},Pe={class:"col"},Ne={class:"text-subtitle1 text-weight-bold q-mb-xs"},je={class:"text-body2 text-grey-8 q-mb-sm"},Le={class:"text-caption text-grey-7"},Me={class:"q-mt-md bg-indigo-1 q-pa-md rounded-borders"},Je={class:"col text-body2"},Ke={class:"col-auto"},Ge={class:"col-auto"},He={class:"flex flex-center bg-grey-4",style:{width:"150px",height:"150px","border-radius":"12px"}},We={class:"q-mb-sm"},Xe=J({__name:"EventCard",props:{eventId:{},event:{},isAdmin:{type:Boolean}},emits:["voted","deleted","archived"],setup(u,{emit:h}){const e=u,d=h,i=ee().currentUser?.uid||"",C=k(!1),g=x(()=>e.event.votedUserIds?.includes(i)??!1),l=Ve({title:e.event.title,description:e.event.description,address:e.event.address,songs:JSON.parse(JSON.stringify(e.event.songs))});async function m(){const o=T(E,"events",e.eventId);await N(o,{title:l.title,description:l.description,address:l.address,songs:l.songs}),C.value=!1}async function w(){if(!confirm("Voulez-vous vraiment supprimer cet Ã©vÃ©nement ?"))return;const t=T(E,"events",e.eventId);await we(t),d("deleted")}async function n(){if(!confirm("Voulez-vous archiver cet Ã©vÃ©nement ?"))return;const t=T(E,"events",e.eventId);await N(t,{archived:!0}),d("archived")}function c(o){return new Date(o).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}async function v(o){if(!i||g.value)return;const t=[...e.event.songs];t[o]&&typeof t[o].votes=="number"&&(t[o].votes+=1);const b=e.event.votedUserIds?[...e.event.votedUserIds,i]:[i],q=T(E,"events",e.eventId);await N(q,{songs:t,votedUserIds:b}),d("voted")}return(o,t)=>(V(),D(B,null,[s(L,{flat:"",bordered:"",class:"q-pa-md q-mb-xl bg-white text-black",style:{"border-radius":"12px"}},{default:f(()=>[r("div",Oe,[r("div",Pe,[r("div",null,[s(W,{color:"deep-purple-5",class:"text-white text-subtitle2 q-pa-sm q-mb-sm",style:{"border-radius":"12px"}},{default:f(()=>[z($(c(o.event.date)),1)]),_:1}),e.isAdmin?(V(),_(I,{key:0,icon:"delete",flat:"",round:"",dense:"",color:"negative",onClick:w,class:"q-ml-sm"},{default:f(()=>[s(j,null,{default:f(()=>t[6]||(t[6]=[z("Supprimer l'Ã©vÃ©nement")])),_:1})]),_:1})):F("",!0),o.isAdmin?(V(),_(I,{key:1,icon:"edit",flat:"",round:"",dense:"",color:"secondary",onClick:t[0]||(t[0]=b=>C.value=!0)},{default:f(()=>[s(j,null,{default:f(()=>t[7]||(t[7]=[z("Modifier lâ€™Ã©vÃ©nement")])),_:1})]),_:1})):F("",!0),e.isAdmin&&!o.event.archived?(V(),_(I,{key:2,icon:"archive",flat:"",round:"",dense:"",color:"primary",onClick:n},{default:f(()=>[s(j,null,{default:f(()=>t[8]||(t[8]=[z("Archiver l'Ã©vÃ©nement")])),_:1})]),_:1})):F("",!0)]),r("div",Ne,$(o.event.title),1),r("div",je,$(o.event.description),1),r("div",Le,$(o.event.address),1),r("div",Me,[t[9]||(t[9]=r("div",{class:"text-weight-medium text-subtitle2 q-mb-sm"}," ðŸ“‹ Votez pour les chansons du concert : ",-1)),(V(!0),D(B,null,O(o.event.songs,(b,q)=>(V(),D("div",{key:q,class:ye(["row items-center q-mb-sm q-pb-sm",{"q-mb-md":q<o.event.songs.length-1}]),style:{"border-bottom":"2px solid #626363"}},[r("div",Je,$(b.title),1),r("div",Ke,[s(W,{color:"deep-purple-4",class:"q-pa-sm q-mr-sm"},{default:f(()=>[z($(b.votes)+" votes ",1)]),_:2},1024),s(I,{class:"bg-deep-purple-3 text-white q-pa-sm",size:"sm",rounded:"",dense:"",flat:"",label:"Voter",disable:g.value,onClick:R=>v(q)},null,8,["disable","onClick"])])],2))),128))])]),r("div",Ge,[r("div",He,[o.event.image?(V(),_(_e,{key:0,src:o.event.image,fit:"cover",style:{"border-radius":"12px"}},null,8,["src"])):(V(),_(X,{key:1,name:"music_note",size:"48px",color:"deep-purple-4"}))])])])]),_:1}),s(De,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=b=>C.value=b),persistent:""},{default:f(()=>[s(L,{style:{"min-width":"400px"}},{default:f(()=>[s(M,null,{default:f(()=>t[10]||(t[10]=[r("div",{class:"text-h6"},"Modifier lâ€™Ã©vÃ©nement",-1)])),_:1}),s(M,null,{default:f(()=>[s(S,{modelValue:l.title,"onUpdate:modelValue":t[1]||(t[1]=b=>l.title=b),label:"Titre",filled:"",class:"q-mb-sm"},null,8,["modelValue"]),s(S,{modelValue:l.description,"onUpdate:modelValue":t[2]||(t[2]=b=>l.description=b),label:"Description",type:"textarea",filled:"",class:"q-mb-sm"},null,8,["modelValue"]),s(S,{modelValue:l.address,"onUpdate:modelValue":t[3]||(t[3]=b=>l.address=b),label:"Adresse",filled:"",class:"q-mb-sm"},null,8,["modelValue"]),r("div",We,[t[11]||(t[11]=r("div",{class:"text-subtitle2 q-mb-xs"},"ðŸŽµ Chansons jouÃ©es",-1)),(V(!0),D(B,null,O(l.songs,(b,q)=>(V(),_(S,{key:q,modelValue:l.songs[q].title,"onUpdate:modelValue":R=>l.songs[q].title=R,label:"Chanson "+(q+1),filled:"",class:"q-mb-xs"},null,8,["modelValue","onUpdate:modelValue","label"]))),128)),s(I,{icon:"add",flat:"",label:"Ajouter une chanson",color:"primary",onClick:t[4]||(t[4]=b=>l.songs.push({title:"",votes:0}))})])]),_:1}),s(Se,{align:"right"},{default:f(()=>[he(s(I,{flat:"",label:"Annuler",color:"grey"},null,512),[[Ae]]),s(I,{flat:"",label:"Enregistrer",color:"primary",onClick:m})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ye=Y(Xe,[["__scopeId","data-v-b6203e0b"]]),Ze={class:"q-mx-auto",style:{"max-width":"900px"}},et={class:"q-mb-md text-right"},tt=J({__name:"CalendrierPage",setup(u){const h=k([]),{role:e}=Qe(),d=k(!1),p=k([]),y=x(()=>{const g=new Date().toISOString();return h.value.filter(l=>d.value||l.date>=g).sort((l,m)=>new Date(l.date).getTime()-new Date(m.date).getTime())});function i(g){return p.value.includes(g)}function C(g){p.value.push(g),localStorage.setItem("votedEvents",JSON.stringify(p.value))}return xe(()=>{const g=localStorage.getItem("votedEvents");g&&(p.value=JSON.parse(g)),Ie(Z(E,"events"),l=>{h.value=l.docs.map(m=>({id:m.id,...m.data()}))})}),(g,l)=>(V(),_(fe,{class:"q-pa-xl bg-gradient text-white"},{default:f(()=>[r("div",Ze,[l[1]||(l[1]=r("div",{class:"text-center q-mb-xl"},[r("h1",{class:"text-h4 text-bold"},"Prochaines ReprÃ©sentations"),r("p",{class:"text-subtitle1"},"Votez pour les chansons et explorez les concerts Ã  venir !")],-1)),r("div",et,[s(Te,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=m=>d.value=m),label:"Afficher les anciens Ã©vÃ©nements",color:"primary"},null,8,["modelValue"])]),H(e)==="admin"?(V(),_(Fe,{key:0,class:"q-mb-xl"})):F("",!0),(V(!0),D(B,null,O(y.value,m=>(V(),_(Ye,{key:m.id,"event-id":m.id,event:m,"is-admin":H(e)==="admin","has-voted":i(m.id),onVoted:w=>C(m.id)},null,8,["event-id","event","is-admin","has-voted","onVoted"]))),128))])]),_:1}))}}),ft=Y(tt,[["__scopeId","data-v-c34f743b"]]);export{ft as default};
