import{u as me,c as ge,b as oe,h as se,Q as re,e as fe}from"./QSpinner-BdPqH2E8.js";import{u as be,b as he,a as ie,Q as ye}from"./QPage-BktnvovB.js";import{r as h,a as u,h as y,g as ue,H as te,I,c as G,o as W,s as X,t as k,v as q,u as V,x as p,y as v,D as Q,E as Y,F as Z,J as Se,i as pe,K as qe,w as xe,z as de,A as H,G as D,L as _e,_ as ce,M as le}from"./index-7VZjFmd5.js";import{u as Ve,b as ke,a as B,Q as we}from"./QForm-Do5BRD4P.js";import{b as Ce,a as K,d as z,e as Ie,c as ve,f as De,u as $e,o as Be}from"./firebase-Cljlgo7c.js";import{g as ee,o as Te}from"./index-35c79a8a-BO3F9RrB.js";import{Q as Qe}from"./QCardSection-CqRoo98m.js";import{Q as T,v as J}from"./QBtn-Bz105Bw_.js";import{u as ae,Q as ze}from"./QTooltip-8Cm8YuMZ.js";import"./focus-manager-DhdJisJs.js";function Ae(e,s){const t=h(null),r=u(()=>e.disable===!0?null:y("span",{ref:t,class:"no-outline",tabindex:-1}));function d(g){const c=s.value;g?.qAvoidFocus!==!0&&(g?.type.indexOf("key")===0?document.activeElement!==c&&c?.contains(document.activeElement)===!0&&c.focus():t.value!==null&&(g===void 0||c?.contains(g.target)===!0)&&t.value.focus())}return{refocusTargetEl:r,refocusTarget:d}}const Re={xs:30,sm:35,md:40,lg:50,xl:60},Ee={...be,...me,...Ve,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:e=>e==="tf"||e==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},Ne=["update:modelValue"];function Ue(e,s){const{props:t,slots:r,emit:d,proxy:g}=ue(),{$q:c}=g,x=he(t,c),b=h(null),{refocusTargetEl:f,refocusTarget:m}=Ae(t,b),i=ge(t,Re),a=u(()=>t.val!==void 0&&Array.isArray(t.modelValue)),n=u(()=>{const l=I(t.val);return a.value===!0?t.modelValue.findIndex(S=>I(S)===l):-1}),o=u(()=>a.value===!0?n.value!==-1:I(t.modelValue)===I(t.trueValue)),_=u(()=>a.value===!0?n.value===-1:I(t.modelValue)===I(t.falseValue)),A=u(()=>o.value===!1&&_.value===!1),N=u(()=>t.disable===!0?-1:t.tabindex||0),U=u(()=>`q-${e} cursor-pointer no-outline row inline no-wrap items-center`+(t.disable===!0?" disabled":"")+(x.value===!0?` q-${e}--dark`:"")+(t.dense===!0?` q-${e}--dense`:"")+(t.leftLabel===!0?" reverse":"")),L=u(()=>{const l=o.value===!0?"truthy":_.value===!0?"falsy":"indet",S=t.color!==void 0&&(t.keepColor===!0||o.value===!0)?` text-${t.color}`:"";return`q-${e}__inner relative-position non-selectable q-${e}__inner--${l}${S}`}),F=u(()=>{const l={type:"checkbox"};return t.name!==void 0&&Object.assign(l,{".checked":o.value,"^checked":o.value===!0?"checked":void 0,name:t.name,value:a.value===!0?t.val:t.trueValue}),l}),$=ke(F),O=u(()=>{const l={tabindex:N.value,role:"switch","aria-label":t.label,"aria-checked":A.value===!0?"mixed":o.value===!0?"true":"false"};return t.disable===!0&&(l["aria-disabled"]="true"),l});function C(l){l!==void 0&&(te(l),m(l)),t.disable!==!0&&d("update:modelValue",P(),l)}function P(){if(a.value===!0){if(o.value===!0){const l=t.modelValue.slice();return l.splice(n.value,1),l}return t.modelValue.concat([t.val])}if(o.value===!0){if(t.toggleOrder!=="ft"||t.toggleIndeterminate===!1)return t.falseValue}else if(_.value===!0){if(t.toggleOrder==="ft"||t.toggleIndeterminate===!1)return t.trueValue}else return t.toggleOrder!=="ft"?t.trueValue:t.falseValue;return t.indeterminateValue}function j(l){(l.keyCode===13||l.keyCode===32)&&te(l)}function R(l){(l.keyCode===13||l.keyCode===32)&&C(l)}const M=s(o,A);return Object.assign(g,{toggle:C}),()=>{const l=M();t.disable!==!0&&$(l,"unshift",` q-${e}__native absolute q-ma-none q-pa-none`);const S=[y("div",{class:L.value,style:i.value,"aria-hidden":"true"},l)];f.value!==null&&S.push(f.value);const w=t.label!==void 0?oe(r.default,[t.label]):se(r.default);return w!==void 0&&S.push(y("div",{class:`q-${e}__label q-anchor--skip`},w)),y("div",{ref:b,class:U.value,...O.value,onClick:C,onKeydown:j,onKeyup:R},S)}}const Le=G({name:"QToggle",props:{...Ee,icon:String,iconColor:String},emits:Ne,setup(e){function s(t,r){const d=u(()=>(t.value===!0?e.checkedIcon:r.value===!0?e.indeterminateIcon:e.uncheckedIcon)||e.icon),g=u(()=>t.value===!0?e.iconColor:null);return()=>[y("div",{class:"q-toggle__track"}),y("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[y(re,{name:d.value,color:g.value})]:void 0)]}return Ue("toggle",s)}}),E=h(null);function Fe(){return W(()=>{const e=ee();Te(e,t=>{t?s(t.uid):E.value=null});async function s(t){const r=await Ce(K(z,"users",t));r.exists()?E.value=r.data().role:E.value="user"}}),{role:E}}const Oe=X({__name:"CreateEventForm",setup(e){const s=h(""),t=h(""),r=h(""),d=h(""),g=h(""),c=h([""]);function x(){c.value.push("")}function b(i){c.value.splice(i,1)}function f(i){const a=i.target.files?.[0];if(a){const n=new FileReader;n.onload=o=>{g.value=o.target?.result},n.readAsDataURL(a)}}async function m(){const a=ee().currentUser;a&&(await Ie(ve(z,"events"),{title:s.value,address:t.value,description:r.value,date:d.value,image:g.value,songs:c.value.map(n=>({title:n,votes:0})),createdBy:a.uid,createdAt:new Date}),s.value="",t.value="",r.value="",d.value="",g.value="",c.value=[""])}return(i,a)=>(q(),k(ie,{class:"q-pa-md q-mb-xl text-black",flat:"",bordered:"",style:{"border-radius":"12px"}},{default:V(()=>[p(Qe,null,{default:V(()=>a[4]||(a[4]=[v("div",{class:"text-h6"},"Créer une nouvelle représentation",-1)])),_:1}),p(we,{onSubmit:Se(m,["prevent"]),class:"q-gutter-md q-pa-sm"},{default:V(()=>[p(B,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=n=>s.value=n),label:"Titre",outlined:"",dense:"",required:""},null,8,["modelValue"]),p(B,{modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=n=>t.value=n),label:"Adresse",outlined:"",dense:"",required:""},null,8,["modelValue"]),p(B,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=n=>r.value=n),label:"Description",type:"textarea",outlined:"",dense:"",required:""},null,8,["modelValue"]),p(B,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=n=>d.value=n),label:"Date",outlined:"",dense:"",type:"date",required:""},null,8,["modelValue"]),v("div",null,[a[5]||(a[5]=v("div",{class:"text-subtitle2 q-mb-xs"},"Image de l'affiche :",-1)),v("input",{type:"file",accept:"image/*",onChange:f},null,32)]),v("div",null,[a[6]||(a[6]=v("div",{class:"text-subtitle2 q-mb-sm"},"Chansons proposées :",-1)),(q(!0),Q(Z,null,Y(c.value,(n,o)=>(q(),Q("div",{key:o,class:"row items-center q-gutter-sm q-mb-sm"},[p(B,{modelValue:c.value[o],"onUpdate:modelValue":_=>c.value[o]=_,label:"Chanson",dense:"",outlined:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"]),p(T,{icon:"close",flat:"",dense:"",color:"negative",onClick:_=>b(o)},null,8,["onClick"])]))),128)),p(T,{flat:"",dense:"",icon:"add",label:"Ajouter une chanson",onClick:x})]),p(T,{type:"submit",label:"Créer",color:"primary",class:"q-mt-md"})]),_:1})]),_:1}))}}),Pe=["top","middle","bottom"],ne=G({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Pe.includes(e)}},setup(e,{slots:s}){const t=u(()=>e.align!==void 0?{verticalAlign:e.align}:null),r=u(()=>{const d=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(d!==void 0?` text-${d}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>y("div",{class:r.value,style:t.value,role:"status","aria-label":e.label},oe(s.default,e.label!==void 0?[e.label]:[]))}}),je={ratio:[String,Number]};function Me(e,s){return u(()=>{const t=Number(e.ratio||(s!==void 0?s.value:void 0));return isNaN(t)!==!0&&t>0?{paddingBottom:`${100/t}%`}:null})}const He=1.7778,Je=G({name:"QImg",props:{...je,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:He},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:s,emit:t}){const r=h(e.initialRatio),d=Me(e,r),g=ue(),{registerTimeout:c,removeTimeout:x}=ae(),{registerTimeout:b,removeTimeout:f}=ae(),m=u(()=>e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null),i=u(()=>e.errorSrc!==void 0?{src:e.errorSrc,__qerror:!0}:null),a=[h(null),h(m.value)],n=h(0),o=h(!1),_=h(!1),A=u(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),N=u(()=>({width:e.width,height:e.height})),U=u(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition q-img__image--`),L=u(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));function F(){if(f(),e.loadingShowDelay===0){o.value=!0;return}b(()=>{o.value=!0},e.loadingShowDelay)}function $(){f(),o.value=!1}function O({target:l}){J(g)===!1&&(x(),r.value=l.naturalHeight===0?.5:l.naturalWidth/l.naturalHeight,C(l,1))}function C(l,S){S===1e3||J(g)===!0||(l.complete===!0?P(l):c(()=>{C(l,S+1)},50))}function P(l){J(g)!==!0&&(n.value=n.value^1,a[n.value].value=null,$(),l.getAttribute("__qerror")!=="true"&&(_.value=!1),t("load",l.currentSrc||l.src))}function j(l){x(),$(),_.value=!0,a[n.value].value=i.value,a[n.value^1].value=m.value,t("error",l)}function R(l){const S=a[l].value,w={key:"img_"+l,class:U.value,style:L.value,alt:e.alt,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...S};return n.value===l?Object.assign(w,{class:w.class+"current",onLoad:O,onError:j}):w.class+="loaded",y("div",{class:"q-img__container absolute-full",key:"img"+l},y("img",w))}function M(){return o.value===!1?y("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},se(s[_.value===!0?"error":"default"])):y("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},s.loading!==void 0?s.loading():e.noSpinner===!0?void 0:[y(fe,{color:e.spinnerColor,size:e.spinnerSize})])}{let l=function(){xe(()=>e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null,S=>{x(),_.value=!1,S===null?($(),a[n.value^1].value=m.value):F(),a[n.value].value=S},{immediate:!0})};pe.value===!0?W(l):l()}return()=>{const l=[];return d.value!==null&&l.push(y("div",{key:"filler",style:d.value})),a[0].value!==null&&l.push(R(0)),a[1].value!==null&&l.push(R(1)),l.push(y(qe,{name:"q-transition--fade"},M)),y("div",{key:"main",class:A.value,style:N.value,role:"img","aria-label":e.alt},l)}}}),Ke={class:"row items-start no-wrap q-col-gutter-md"},Ge={class:"col"},We={class:"text-subtitle1 text-weight-bold q-mb-xs"},Xe={class:"text-body2 text-grey-8 q-mb-sm"},Ye={class:"text-caption text-grey-7"},Ze={class:"q-mt-md bg-indigo-1 q-pa-md rounded-borders"},et={class:"col text-body2"},tt={class:"col-auto"},lt={class:"col-auto"},at={class:"flex flex-center bg-gradient",style:{width:"150px",height:"150px","border-radius":"12px","box-shadow":"0 4px 10px rgba(0, 0, 0, 0.15)"}},nt=X({__name:"EventCard",props:{eventId:{},event:{},isAdmin:{type:Boolean}},emits:["voted","deleted"],setup(e,{emit:s}){const t=e,r=s,c=ee().currentUser?.uid||"",x=u(()=>t.event.votedUserIds?.includes(c)??!1);async function b(){if(!confirm("Voulez-vous vraiment supprimer cet événement ?"))return;const a=K(z,"events",t.eventId);await De(a),r("deleted")}function f(i){return new Date(i).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}async function m(i){if(!c||x.value)return;const a=[...t.event.songs];a[i]&&typeof a[i].votes=="number"&&(a[i].votes+=1);const n=t.event.votedUserIds?[...t.event.votedUserIds,c]:[c],o=K(z,"events",t.eventId);await $e(o,{songs:a,votedUserIds:n}),r("voted")}return(i,a)=>(q(),k(ie,{flat:"",bordered:"",class:"q-pa-md q-mb-xl bg-white text-black",style:{"border-radius":"12px"}},{default:V(()=>[v("div",Ke,[v("div",Ge,[v("div",null,[p(ne,{color:"deep-purple-5",class:"text-white text-subtitle2 q-pa-sm q-mb-sm",style:{"border-radius":"12px"}},{default:V(()=>[H(D(f(i.event.date)),1)]),_:1}),t.isAdmin?(q(),k(T,{key:0,icon:"delete",flat:"",round:"",dense:"",color:"negative",onClick:b,class:"q-ml-sm"},{default:V(()=>[p(ze,null,{default:V(()=>a[0]||(a[0]=[H("Supprimer l'événement")])),_:1})]),_:1})):de("",!0)]),v("div",We,D(i.event.title),1),v("div",Xe,D(i.event.description),1),v("div",Ye,D(i.event.address),1),v("div",Ze,[a[1]||(a[1]=v("div",{class:"text-weight-medium text-subtitle2 q-mb-sm"}," 📋 Votez pour les chansons du concert : ",-1)),(q(!0),Q(Z,null,Y(i.event.songs,(n,o)=>(q(),Q("div",{key:o,class:_e(["row items-center q-mb-sm q-pb-sm",{"q-mb-md":o<i.event.songs.length-1}]),style:{"border-bottom":"2px solid #626363"}},[v("div",et,D(n.title),1),v("div",tt,[p(ne,{color:"deep-purple-4",class:"q-pa-sm q-mr-sm"},{default:V(()=>[H(D(n.votes)+" votes ",1)]),_:2},1024),p(T,{class:"bg-deep-purple-3 text-white q-pa-sm",size:"sm",rounded:"",dense:"",flat:"",label:"Voter",disable:x.value,onClick:_=>m(o)},null,8,["disable","onClick"])])],2))),128))])]),v("div",lt,[v("div",at,[i.event.image?(q(),k(Je,{key:0,src:i.event.image,fit:"cover",style:{"border-radius":"12px"}},null,8,["src"])):(q(),k(re,{key:1,name:"music_note",size:"48px",color:"white"}))])])])]),_:1}))}}),ot=ce(nt,[["__scopeId","data-v-1f1ed847"]]),st={class:"q-mx-auto",style:{"max-width":"900px"}},rt={class:"q-mb-md text-right"},it=X({__name:"CalendrierPage",setup(e){const s=h([]),{role:t}=Fe(),r=h(!1),d=h([]),g=u(()=>{const b=new Date().toISOString();return s.value.filter(f=>r.value||f.date>=b).sort((f,m)=>new Date(f.date).getTime()-new Date(m.date).getTime())});function c(b){return d.value.includes(b)}function x(b){d.value.push(b),localStorage.setItem("votedEvents",JSON.stringify(d.value))}return W(()=>{const b=localStorage.getItem("votedEvents");b&&(d.value=JSON.parse(b)),Be(ve(z,"events"),f=>{s.value=f.docs.map(m=>({id:m.id,...m.data()}))})}),(b,f)=>(q(),k(ye,{class:"q-pa-xl bg-gradient text-white"},{default:V(()=>[v("div",st,[f[1]||(f[1]=v("div",{class:"text-center q-mb-xl"},[v("h1",{class:"text-h4 text-bold"},"Prochaines Représentations"),v("p",{class:"text-subtitle1"},"Votez pour les chansons et explorez les concerts à venir !")],-1)),v("div",rt,[p(Le,{modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=m=>r.value=m),label:"Afficher les anciens événements",color:"primary"},null,8,["modelValue"])]),le(t)==="admin"?(q(),k(Oe,{key:0,class:"q-mb-xl"})):de("",!0),(q(!0),Q(Z,null,Y(g.value,m=>(q(),k(ot,{key:m.id,"event-id":m.id,event:m,"is-admin":le(t)==="admin","has-voted":c(m.id),onVoted:i=>x(m.id)},null,8,["event-id","event","is-admin","has-voted","onVoted"]))),128))])]),_:1}))}}),St=ce(it,[["__scopeId","data-v-f470c8f7"]]);export{St as default};
